<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8"/>
    <title>Twains uWu</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />

    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css"
	  integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
	  crossorigin=""/>
    <!-- Make sure you put this AFTER Leaflet's CSS -->
    <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"
	    integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew=="/
	    crossorigin=""></script>

    <script src="./fa.js"></script>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.2.0/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.css" />
    <script src="https://unpkg.com/leaflet@1.2.0/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.js"></script>
    
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">

    <!-- Load Esri Leaflet from CDN -->
    <script src="https://unpkg.com/esri-leaflet@2.3.3/dist/esri-leaflet.js"
	    integrity="sha512-cMQ5e58BDuu1pr9BQ/eGRn6HaR6Olh0ofcHFWe5XesdCITVuSBiBZZbhCijBe5ya238f/zMMRYIMIIg1jxv4sQ=="
	    crossorigin=""></script> 

    <!-- Include Leaflet.heat from CDN -->
    <script src="https://unpkg.com/leaflet.heat@0.2.0/dist/leaflet-heat.js"></script>

    <!-- Load Heatmap Feature Layer from CDN -->
    <script src="https://unpkg.com/esri-leaflet-heatmap@2.0.0"></script>




    <script src="./Leaflet.Control.Custom.js"></script>


    <style>
      #mapid {
	  height: 95vh;
      }
    </style>
    
  </head>
  <body>
    <div id="mapid">

    </div>
  </body>

  <script>
    /* https://www.arcgis.com/home/item.html?id=96ec03e4fc8546bd8a864e39a2c3fc41 */


    var position = {lat: 37.762468,  lon: -122.419019};
    
    //var mymap = L.map('mapid').setView([0, 0], 1);
    var mymap = L.map('mapid', {
	preferCanvas: true
    }).setView([37.75, -122.23], 6);
    
    var union_pacific_geojson = new Request('UnionPacific.json');
    
    var bnsf_geojson = new Request('BNSF.geojson')

    var csx_geojson = new Request('CSX.geojson')
    
    var cpac_geojson = new Request('CanadianPacific.geojson')
    
    var cnat_geojson = new Request('CanadianNational.geojson')
    
    var kcs_geojson = new Request('KansasCitySouthern.geojson')
    
    var other_geojson = new Request('ShortLines.geojson')

    var legend = L.control({ position: "bottomleft" });

    legend.onAdd = function(map) {
	var div = L.DomUtil.create("div", "legend");
	div.innerHTML += "<h4>Legend<g/h4>";
	div.innerHTML += '<i style="background-color: #bf8a33">__</i><span>Union Pacific</span><br>';
	div.innerHTML += '<i style="background: #448D40">__</i><span>BNSF</span><br>';
	div.innerHTML += '<i style="background: #E6E696">__</i><span>CSX</span><br>';
	div.innerHTML += '<i style="background: #E8E6E0">__</i><span>Norfolk Southern</span><br>';
	div.innerHTML += '<i style="background: #ed1d24">__</i><span>Canadian Pacific (US data only)</span><br>';
	div.innerHTML += '<i style="background: blue">__</i><span>Canadian National (US data only)</span><br>';
	div.innerHTML += '<i style="background: violet">__</i><span>Kansas Southern</span><br>';
	div.innerHTML += '<i style="background: purple">__</i><span>Other / Short Lines</span><br>';
	return div;
    };


    
    var csx_geojay =
 	fetch(csx_geojson)
 	.then((response) => {
 	    return response.json()
 	})
 	.then((data) => {
 	    L.geoJson(data,
		      {
			  style: function(feature) {
			      return { color: '#E6E696' }
			  }
		      }).addTo(mymap);
	    
	});

    
    var up_geojson =
 	fetch(union_pacific_geojson)
 	.then((response) => {
 	    return response.json()
 	})
 	.then((data) => {
 	    L.geoJson(data,
		      {
			  style: function(feature) {
			      return { color: '#bf8a33' }
			  }
		      })
 		.addTo(mymap);
 	});
    
    var bnsf_geojay =
 	fetch(bnsf_geojson)
 	.then((response) => {
 	    return response.json()
 	})
 	.then((data) => {
 	    L.geoJson(data,
		      {
			  style: function(feature) {
			      return { color: '#448D40' }
			  }
		      }).addTo(mymap);
	    
	});



    
    var cpac_geojay =
 	fetch(cpac_geojson)
 	.then((response) => {
 	    return response.json()
 	})
 	.then((data) => {
 	    L.geoJson(data,
		      {
			  style: function(feature) {
			      return { color: '#ed1d24' }
			  }
		      }).addTo(mymap);
	    
	});
    
    var cnat_geojay =
 	fetch(cnat_geojson)
 	.then((response) => {
 	    return response.json()
 	})
 	.then((data) => {
 	    L.geoJson(data,
		      {
			  style: function(feature) {
			      return { color: 'red'}
			  }
		      }).addTo(mymap);
	    
	});
    
    
    var kcs_geojay =
 	fetch(kcs_geojson)
 	.then((response) => {
 	    return response.json()
 	})
 	.then((data) => {
	    geojson = L.geoJson(data, {
		style: style,
		onEachFeature: onEachFeature
	    }).addTo(mymap);
	    
 	    L.geoJson(data,
		      {
			  style: function(feature) {
			      return { color: 'violet' }
			  }
		      }).addTo(mymap);
	    
	});
    
    var other_geojay =
 	fetch(other_geojson)
 	.then((response) => {
 	    return response.json()
 	})
 	.then((data) => {
 	    L.geoJson(data,
		      {
			  style: function(feature) {
			      return { color: 'purple' }
			  }
		      }).addTo(mymap);
	    
	});
    

    
    L.esri.basemapLayer('Gray').addTo(mymap);
    
    L.control.scale().addTo(mymap); 

    legend.addTo(mymap);

    function onLocationFound(e) {
	var radius = e.accuracy;

	L.marker(e.latlng).addTo(map)
            .bindPopup("You are within " + radius + " meters from this point").openPopup();

	L.circle(e.latlng, radius).addTo(map);
    }

    mymap.on('locationfound', onLocationFound);

    
    function onLocationError(e) {
	alert(e.message);
    }

    mymap.on('locationerror', onLocationError);

    function highlightFeature(e) {
	var layer = e.target;

	layer.setStyle({
            weight: 5,
            color: '#666',
            dashArray: '',
            fillOpacity: 0.7
	});

	if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
            layer.bringToFront();
	}
    }

    function resetHighlight(e) {
	geojson.resetStyle(e.target);
    }

    function onEachFeature(feature, layer) {
	layer.on({
            mouseover: highlightFeature,
            mouseout: resetHighlight,
            click: () => {}
	});
    }
    function style(feature) {
	return {
            fillColor: 'purple',
            weight: 2,
            opacity: 1,
            color: 'white',
            dashArray: '3',
            fillOpacity: 0.7
	};
    }
    L.control.custom({
	position: 'topright',
	content : '<button type="button" class="btn btn-default">'+
            '    <i class="fa fa-crosshairs"></i>'+
            '</button>'+

	'<input type="text" class="form-control" placeholder="Source" aria-label="Username" aria-describedby="basic-addon1">' +
	    '<input type="text" class="form-control" placeholder="Destination" aria-label="Username" aria-describedby="basic-addon1">',

	// '<button type="button" class="btn btn-info">'+
        //     '    <i class="fa fa-compass"></i>'+
        //     '</button>'+
	
        //     '<button type="button" class="btn btn-primary">'+
        //     '    <i class="fa fa-spinner fa-pulse fa-fw"></i>'+
        //     '</button>'+
	
        //     '<button type="button" class="btn btn-danger">'+ m
        //     '    <i class="fa fa-times"></i>'+
        //     '</button>'+
	
        //     '<button type="button" class="btn btn-success">'+
        //     '    <i class="fa fa-check"></i>'+
        //     '</button>'+
	
        //     '<button type="button" class="btn btn-warning">'+
        //     '    <i class="fa fa-exclamation-triangle"></i>'+
        //     '</button>',
	classes : 'btn-group-vertical btn-group-sm col-6 col-md-12',
	style   :
	{
            margin: '10px',
            padding: '0px 0 0 0',
            cursor: 'pointer',
	},
	datas   :
	{
            'foo': 'bar',
	},
	events:
	{
	    
	    keypress: function (data) {
		// If user presses enter, log the input text to console.
		if(data.keyCode == 13) {
		    console.log(data.target.value)
		}
		
	    },

	    
	    touch: function(data)
            {
		// 		console.log(data); 
            },
            click: function(data)
            {
		// console.log(data.target.child);
            },
            dblclick: function(data)
            {
		// console.log('wrapper div element dblclicked');
		// console.log(data);
            },
            contextmenu: function(data)
            {
		// console.log('wrapper div element contextmenu');
		// console.log(data);
            },
	}
    })

    .addTo(mymap);


    // The following code uses OpenSourceMapsRouter to get walking / driving directions
    // It will display a little control menu underneath search.
    // var temp =
    // 	fetch(bnsf_geojson)
    // 	.then((response) => {
    // 	    return response.json()
    // 	})
    // 	.then((data) => {

    // 	    L.Routing.control({
    // 		waypoints: [
    // 		    L.GeoJSON.coordsToLatLng(data.features[0].geometry.coordinates[0][0]),
    // 		    L.GeoJSON.coordsToLatLng(data.features[0].geometry.coordinates[0][4])
    // 		],
    // 		routeWhileDragging: true}).addTo(mymap);
    // 	});

    
    

	</script>
</html>
